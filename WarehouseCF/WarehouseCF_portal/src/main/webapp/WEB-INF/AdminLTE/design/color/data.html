<!--
  ~ Copyright (c) 2019. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  ~ Morbi non lorem porttitor neque feugiat blandit. Ut vitae ipsum eget quam lacinia accumsan.
  ~ Etiam sed turpis ac ipsum condimentum fringilla. Maecenas magna.
  ~ Proin dapibus sapien vel ante. Aliquam erat volutpat. Pellentesque sagittis ligula eget metus.
  ~ Vestibulum commodo. Ut rhoncus gravida arcu.
  -->

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AdminLTE 2 | Data Tables</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="../../bower_components/select2/dist/css/select2.min.css">
  <!-- bootstrap-select -->
  <link rel="stylesheet" href="../../bower_components/bootstrap-select/dist/css/bootstrap-select.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="../../bower_components/Ionicons/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="../../bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
  <!--<link rel="stylesheet" href="../../bower_components/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.min.css">-->
  <!-- DataTables Extends-->
  <!--<link rel="stylesheet" type="text/css" href="../../bower_components/DataTables/DataTables-1.10.18/css/jquery.dataTables.min.css"/>-->
  <link rel="stylesheet" type="text/css" href="../../bower_components/DataTables/Buttons-1.5.6/css/buttons.dataTables.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<body style="background-color: transparent">
<div class="wrapper">
    <section class="content-header">
      <h1>
        设计元素
        <small>颜色</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i>欢迎页</a></li>
        <li><a href="#">设计元素</a></li>
        <li class="active">颜色</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">
      <!-- 表格 -->
      <div class="row">
        <div class="col-xs-12">
          <div class="box box-warning">
            <div class="box-header">
              <h3 class="box-title">设计颜色</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <!-- 下拉菜单 -->
              <!--<div class="row">-->
                <!--&lt;!&ndash;<div class="col-md-1">&ndash;&gt;-->
                  <!--&lt;!&ndash;<div class="form-group">&ndash;&gt;-->
                    <!--&lt;!&ndash;<select class="form-control select2" style="width: 100%;">&ndash;&gt;-->
                    <!--&lt;!&ndash;</select>&ndash;&gt;-->
                  <!--&lt;!&ndash;</div>&ndash;&gt;-->
                <!--&lt;!&ndash;</div>&ndash;&gt;-->
                <!--<div class="col-md-2">-->
                  <!--<div class="form-group">-->
                    <!--<button class="btn  btn-primary" id="newAttribute">新增颜色</button>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
              <!--<div class="row">-->
                <!--<div class="col-md-12">-->
                  <!--<div class="form-group">-->
                  <!--<div>-->
                    <!--<label>子类颜色</label>-->
                  <!--</div>-->
                  <!--<div>-->
                    <!--<button class="btn  btn-primary" id="newAttribute">新增颜色</button>-->
                  <!--</div>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
              <!-- 表格 -->
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <table id="example" class="table table-striped table-bordered">
                      <thead>
                        <tr>
                          <th>选择</th>
                          <th>颜色编号</th>
                          <th>颜色名称</th>
                          <th>所属色系</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                      <!--<tfoot>-->
                        <!--<th>按颜色编号查询</th>-->
                        <!--<th>按颜色名称查询</th>-->
                        <!--<th>按颜色色系查询</th>-->
                      <!--</tfoot>-->
                      <!-- tfoot是搜索 -->
                      <!-- tbody是必须的 -->
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
</div>
  <!-- 编辑页面 -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="box box-warning">
            <form class="form-horizontal">
              <div class="box-body">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                  </button>
                  <h4 class="modal-title" id="myModalLabel">
                    编辑颜色
                  </h4>
                </div>
                <div class="modal-body">
                  <div class="form-group">
                    <label for="colorBranchId" class="col-sm-2 control-label">颜色编号</label>
                    <div class="col-sm-10">
                      <input type="input" disabled="disabled" class="form-control" id="colorBranchId">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="edit-select" class="col-sm-2 control-label">所属颜色</label>
                    <div class="col-sm-10">
                      <select id="edit-select" class="form-control select2" style="width: 100%;">
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="colorBranchName" class="col-sm-2 control-label">颜色名称</label>
                    <div class="col-sm-10">
                      <input type="input" class="form-control" id="colorBranchName">
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                  <button type="button" onclick="editBranchColor()" class="btn btn-primary">提交更改</button>
                </div>
              </div><!-- /.modal-content -->
            </form>
          </div>
        </div>
      </div><!-- /.modal -->
  </div>
<!-- jQuery 3 -->
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="../../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<!-- DataTables Extends-->
<script src="../../bower_components/DataTables/Buttons-1.5.6/js/dataTables.buttons.min.js"></script>
<script src="../../bower_components/DataTables/Buttons-1.5.6/js/buttons.bootstrap.min.js"></script>
<!--打印-->
<script src="../../bower_components/DataTables/Buttons-1.5.6/js/buttons.print.min.js"></script>
<!--导出-->
<script src="../../bower_components/DataTables/Buttons-1.5.6/js/buttons.html5.min.js"></script>
<!-- SlimScroll -->
<script src="../../bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- Select2 -->
<script src="../../bower_components/select2/dist/js/select2.full.min.js"></script>
<!-- bootstrap-select -->
<script src="../../bower_components/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
<!-- FastClick -->
<script src="../../bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<!-- page script -->
<script>
  // var colorBranchName;
  $('#editModal').on('shown.bs.modal', function (event) {
    var colorBranchId  = $(event.relatedTarget).attr('data-colorBranchId');
    var colorBranchName  = $(event.relatedTarget).attr('data-colorBranchName');
    var colorName  = $(event.relatedTarget).attr('data-colorName');
    // console.log(colorName);
    $("#colorBranchId").val(colorBranchId);
    $("#colorBranchName").val(colorBranchName);
    // $('#edit-select').html('<option value="1">' +colorName+ '</option>').trigger("change");
    $("#edit-select").select2({
      initSelection : function (element, callback) {
        console.log(colorName);
        var data = {id: colorName, text: colorName};
        callback(data);
      },
      // placeholder: colorName,
      ajax: {
        url: '/mainPage/goDesign/colorParent',
        dataType: 'json',
      }
    });
    // $("#edit-select").select2('val','1');
  });
  // $(function () {
  //   //初始化下拉菜单
  //   $("#edit-select").select2({
  //     // placeholder: '基础颜色',
  //     ajax: {
  //       url: '/mainPage/goDesign/colorParent',
  //       dataType: 'json',
  //     }
  //   });
  //   $("#edit-select").val("pxx");
  //   //下拉菜单点击处理事件
  //   $("#edit-select").on("change", function(e) {
  //     // reloadTable($("#edit-select").val());
  //   });
  // });
  //初始化表格
  $(document).ready(function() {
    var params=$(".select2").val();
    if(params == null){
      params = "0";
    }
    //表格
    $('#example').DataTable( {
      //重新布局表格
      dom:  "<'row'<'col-sm-1'<'select'>><'col-sm-11'B>>" +
              "<'row'<'col-sm-12'tr>>" +
              "<'row'<'col-sm-5'l><'col-sm-7'p>>",
      //添加表格上方的按钮
      buttons: [
        {
          text: '<i class="glyphicon glyphicon-copy" title="复制"></i>',
          extend: 'copy'
        }, {
          text: '<i class="glyphicon glyphicon-print" title="打印"></i>',
          extend: 'print'
        }, {
          text: '<i class="glyphicon glyphicon-save-file" title="导出excel"></i>',
          extend: 'excel'
        }, {
          text: '<i class="glyphicon glyphicon-list-alt" title="导出csv"></i>',
          extend: 'csv'
        }, {
          text: '<i class="glyphicon glyphicon-file" title="生成pdf"></i>',
          extend: 'pdf'
        },'reload','add','delete'
      ],
      //服务器模式打开
      serverSide: true,
      //ajax请求
      ajax: {
        url:"/mainPage/goDesign/color",
        data: {"colorid":params},
        dataType:"json",
        cache:false
      },
      //表格列
      columns: [
        { "data": null , defaultContent: ''},
        { "data": "colorBranchId" },
        { "data": "colorBranchName" },
        { "data": "wbColor.colorName" },
        { "data": null , defaultContent: ''}
      ],
      //自定义列
      columnDefs: [
        {
          targets: -1,
          visible: true,
          sortable: false,
          render: function(data, type, row){
            return  '<a href="#" title="详情">' +
                    '<i class="glyphicon glyphicon-eye-open"></i> ' +
                    '</a>'+
                    '<a data-toggle="modal" data-target="#editModal" data-colorBranchId="' + row.colorBranchId +'" data-colorBranchName="' + row.colorBranchName +'" data-colorName="' + row.wbColor.colorName +'" title="修改">' +
                    '<i class="glyphicon glyphicon-pencil"></i> ' +
                    '</a>'+
                    '<a href="#delProject" data-toggle="modal" data-id="' + row.p_id +'" title="删除">' +
                    '<i class="glyphicon glyphicon-trash text-danger"></i> ' +
                    '</a>';
          }
        },
        {
          targets: 0,
          render: function(data, type, row, meta) {
            return '<input type="checkbox" name="checklist" value="' + row.name + '" />'
          }
        }
      ],
      searching: false,
      autoFill: true,
      bAutoWidth : true,
      ordering:false,
      fixedHeader: true,
      //语言修改为中文
      language: {
        lengthMenu: "每页显示 _MENU_条",
        sZeroRecords : "没有您要搜索的内容",
        oPaginate: {
          sFirst : "第一页",
          sPrevious : "上一页",
          sNext : "下一页",
          sLast : "最后一页"
        },
      },
      pagingType: "full_numbers",
      info: false,
      //表格初始化完成后加载下拉菜单
      fnInitComplete: function(){
        $('div.select').html('<select id="table-select" class="form-control select2" style="width: 100%;"></select>');
        $("#table-select").select2({
          placeholder: '基础颜色',
          ajax: {
            url: '/mainPage/goDesign/colorParent',
            dataType: 'json',
          }
        });
        //下拉菜单点击处理事件
        $("#table-select").on("change", function(e) {
          reloadTable($("#table-select").val());
        });
      }
    } );
  } );
  //重新加载表格
  function reloadTable(id) {
    var param = {
      "colorid": id,
    };
    $('#example').DataTable().settings()[0].ajax.data = param;
    $('#example').DataTable().ajax.reload();
  }
  //表格上方刷新按钮刷新
  $.fn.dataTable.ext.buttons.reload = {
    text: '<i class="glyphicon glyphicon-refresh" title="刷新"></i>',
    action: function ( e, dt, node, config ) {
      // dt.ajax.reload();
      reloadTable(0);
    }
  };
  //表格上方新增按钮新增
  $.fn.dataTable.ext.buttons.add = {
    text: '<i class="glyphicon glyphicon-plus" title="新增"></i>',
    action: function ( e, dt, node, config ) {
      // dt.ajax.reload();
    }
  };
  //表格上方删除按钮删除
  $.fn.dataTable.ext.buttons.delete = {
    text: '<i class="glyphicon glyphicon-trash text-danger" title="删除"></i>',
    action: function ( e, dt, node, config ) {
      // dt.ajax.reload();
    }
  };

  function editBranchColor(){
    var colorBranchId  = $("#colorBranchId").val();
    var colorBranchName  = $("#colorBranchName").val();
    var colorName  = $("#edit-select").val();
    $.ajax({
      url:"/mainPage/goDesign/color/edit",
      type:"post",
      data:{"colorBranchId":colorBranchId,"colorBranchName":colorBranchName,"colorName":colorName},
      success:function(data){
        $('#editModal').modal('hide');
        alert(data.success);
        $('#example').DataTable().ajax.reload();
      },
      error:function(e){
        alert("错误！！");
      }
    });
  }
</script>
</body>
</html>
